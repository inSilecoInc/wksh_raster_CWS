---
title: "intro to sf"
---


```{r include = FALSE}
source("_setup.R")
```

---

class: inverse, center, middle

# `r nf()` Introduction to `sf`

![:custom_hr]()

## `r ck()` ~20min


???

If after the workshop what follows makes sense and you feel it is kind of true, it would a success.

---

# Introduction to `sf`

## What is `sf`

Intro to package, vector objects


---

# Introduction to `sf`

## `sf` objects

.pull-left[
- Most common geometries:
  - `POINT`
  - `MULTIPOINT`
  - `LINESTRING`
  - `MULTILINESTRING`
  - `POLYGON`
  - `MULTIPOLYGON`
  - `GEOMETRYCOLLECTION`
]

.pull-right[
![](https://r-spatial.github.io/sf/articles/sf1_files/figure-html/unnamed-chunk-20-1.png)
]


---

# Introduction to `sf`

## `sf` objects

![](https://r-spatial.github.io/sf/articles/sf_xfig.png)

---

# Introduction to `sf`

## Importing: from `.csv`

[Computerized Database of Qu√©bec Seabirds (CDQS)](https://open.canada.ca/data/en/dataset/9cd6f8a1-e660-4e78-89a8-6e3f781da556)

```{r csv}
if (!file.exists("data/cdqs.csv")) {
  download.file("http://donnees.ec.gc.ca/data/species/assess/computerized-database-of-qu-bec-seabirds-cdqs/CDQS_BIOMQ_2017.csv",
                destfile = "data/cdqs.csv")
}

# Import csv
cdqs <- read.csv('data/cdqs.csv')
```

---

# Introduction to `sf`

## Importing: from `.csv`

```{r csvsf}
cdqs <- st_as_sf(x = cdqs,
                 coords = c("CentroideX", "CentroideY"),
                 crs = 4326)
```

.font80[
```{r showcsvsf, echo = FALSE}
cdqs[,1]
```
]

---

# Introduction to `sf`

## Importing: from `.csv`

```{r csvplot}
plot(st_geometry(cdqs))
```


---


# Introduction to `sf`

## Importing: from `.shp`

[Roseate Tern critical habitats in Atlantic Canada](https://open.canada.ca/data/en/dataset/0c469c0e-8afd-4c62-9420-c50af2d34f97)

```{r shp, messages = FALSE, warnings = FALSE}
if (!file.exists("data/roseate.zip")) {
  download.file("http://data.ec.gc.ca/data/species/assess/atlantic-canada-critical-habitat-data/roseate-tern-sterna-dougallii-critical-habitat-for-species-at-risk-atlantic-canada-nova-scotia/Sterna_dougallii_Roseate_Tern_CH_2015.zip",
                destfile = "data/roseate.zip")
  unzip("data/roseate.zip", exdir = 'data')
}

# Import shapefile
roseate <- st_read("data/Sterna_dougallii_Roseate_Tern_CH_2015.shp", quiet = TRUE)
```

---


# Introduction to `sf`

## Importing: from `.shp`

[Roseate Tern critical habitats in Atlantic Canada](https://open.canada.ca/data/en/dataset/0c469c0e-8afd-4c62-9420-c50af2d34f97)

.font80[
```{r showshp, echo = FALSE}
roseate
```
]

---


# Introduction to `sf`

## Importing: from `.shp`

[Roseate Tern critical habitats in Atlantic Canada](https://open.canada.ca/data/en/dataset/0c469c0e-8afd-4c62-9420-c50af2d34f97)

.font80[
```{r shpplot}
plot(st_geometry(roseate[4,]))
```
]

---

# Introduction to `sf`

## Importing: from `.geojson`

We already have a geojson included in the workshop data: `st_laurence.geojson`

```{r geojson, hold = TRUE}
stl <- st_read('data/st_laurence.geojson')
stl
```

`r tr()` We strongly suggest using geojson (single file) rather than shapefiles (multiple files)

---

# Introduction to `sf`

## Importing: from `.geojson`

We already have a geojson included in the workshop data: `st_laurence.geojson`

```{r geojsonplot, eval = FALSE}
plot(st_geometry(stl))
```


---

# Introduction to `sf`

## Importing: from `.gbd`

[Atlas of Seabirds at Sea in Eastern Canada 2006-2016](https://open.canada.ca/data/en/dataset/f612e2b4-5c67-46dc-9a84-1154c649ab4e)

```{r gbd, messages = FALSE, warnings = FALSE}
if (!file.exists("data/atlas.zip")) {
  download.file("http://data.ec.gc.ca/data/species/assess/atlas-of-seabirds-at-sea-in-eastern-canada-2006-2016/AtlasGrid-GrilleAtlas.gdb.zip",
                destfile = "data/atlas.zip")
  unzip("data/atlas.zip", exdir = 'data')
}
```

---

# Introduction to `sf`

## Importing: from `.gbd`

[Atlas of Seabirds at Sea in Eastern Canada 2006-2016](https://open.canada.ca/data/en/dataset/f612e2b4-5c67-46dc-9a84-1154c649ab4e)

```{r gbdlayer, messages = FALSE, warnings = FALSE}
# Visualize layers available in the geodatabase
st_layers("data/AtlasGrid-GrilleAtlas.gdb")

# Load layer
atlas <- st_read('data/AtlasGrid-GrilleAtlas.gdb',
                  layer = 'AtlasGrid_GrilleAtlas')
```

---

# Introduction to `sf`

## Importing: from `.gbd`

[Atlas of Seabirds at Sea in Eastern Canada 2006-2016](https://open.canada.ca/data/en/dataset/f612e2b4-5c67-46dc-9a84-1154c649ab4e)

```{r gbdplot, messages = FALSE, warnings = FALSE}
plot(st_geometry(atlas))
```

---

# Introduction to `sf`

## Exporting

```{r export}
st_write(roseate, "data/roseate.shp", delete_dsn = TRUE)
st_write(stl, "data/stl.geojson", delete_dsn = TRUE)
```

---

# Introduction to `sf`

## Exporting

```{r echo = FALSE}
oldopt <- options()$width
options(width=150)
```

.font60[
```{r drivers}

st_drivers()
```
]

```{r echo = FALSE}
options(width=oldopt)
```


---

# Introduction to `sf`

## Transform between `sf` and `sp`


`r tr()` You can use `st_as_sf()` to transform `sp` object to `sf` objects...

.font80[
```{r sp, eval = FALSE}
# Do not run
newsf <- st_as_sf(oldsp)
```
]

... and vice-versa with `as()`

.font80[
```{r spsf, eval = FALSE}
# Do not run
newsp <- as(oldsf, "Spatial")
```
]


---

# Introduction to `sf`

## Projection

`r tr()` Covered in `stars` portion of the workshop


---

# introduction to `sf`

## Manipulating attributes

- The `sf` package is built to work well with the `tidyverse`

```{r atlasdata}
if (!file.exists("data/atlasdata.xlsx")) {
  download.file("http://data.ec.gc.ca/data/species/assess/atlas-of-seabirds-at-sea-in-eastern-canada-2006-2016/DensityData-DonneesDeDensite.xlsx",
                destfile = "data/atlasdata.xlsx")
}

x = read.table("data/atlasdata.xlsx", skip = 1)
x = readxl::read_excel("data/atlasdata.xlsx", sheet = 2)

```


















---

# Introduction to `sf`

## Create a `sf` object

.pull-left[
```{r mydata}
# Dummy data
mylon <- -82+2*runif(20)
mylat <- 42+2*runif(20)
mydata <- data.frame(
  lon = mylon,
  lat = mylat,
  var1 = rnorm(20),
  var2 = 10*runif(20))
```
]

.pull-right[
.font80[
```{r showmydata, echo = FALSE}
mydata[1:10, ]
```
]
]

`r tr()` Does this look familiar? You probably often deal with this type of data in the form of a `.csv` file with coordinates and attributes.

---

# Introduction to `sf`

## Create a `sf` object

.pull-left[
```{r createsf}
library(sf)
pts_sf <- st_as_sf(x = mydata,
                   coords = c("lon", "lat"),
                   crs = 4326)
```

.font80[
```{r showsf, echo = FALSE}
pts_sf
```
]
]



---



This section should cover sf

* what is it
* understand the object
* how to manipulate sf attribute tabkle with tidyverse
* how to do basic spatial manipulations
  * intersect /union / difference
  * projection
  * areas
