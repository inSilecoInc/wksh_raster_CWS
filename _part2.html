<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Raster with R</title>
    <meta charset="utf-8" />
    <meta name="author" content="inSileco Team" />
    <meta name="date" content="2021-03-21" />
    <script src="assets/header-attrs/header-attrs.js"></script>
    <link href="assets/remark-css/default.css" rel="stylesheet" />
    <link href="assets/remark-css/hygge.css" rel="stylesheet" />
    <script src="assets/clipboard/clipboard.min.js"></script>
    <link href="assets/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="assets/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"<i class=\"fa fa-clipboard\"><\/i>","success":"<i class=\"fa fa-check\" style=\"color: #37abc8\"><\/i>","error":"Press Ctrl+C to Copy"})</script>
    <link href="assets/font-awesome/css/all.css" rel="stylesheet" />
    <link href="assets/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <script src="assets/fabric/fabric.min.js"></script>
    <link href="assets/xaringanExtra-scribble/scribble.css" rel="stylesheet" />
    <script src="assets/xaringanExtra-scribble/scribble.js"></script>
    <script>document.addEventListener('DOMContentLoaded', function() { window.xeScribble = new Scribble({"pen_color":["#FF0000"],"pen_size":3,"eraser_size":30}) })</script>
    <link rel="stylesheet" href="rd.css" type="text/css" />
    <link rel="stylesheet" href="rd-font.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">






class: title-slide, middle


## .font200[&lt;svg viewBox="0 0 581 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"&gt;&lt;/path&gt;&lt;/svg&gt;asters]

&lt;br&gt;

.instructors[
  .font140[Manipulate and visualize spatial data with &lt;svg viewBox="0 0 581 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"&gt;&lt;/path&gt;&lt;/svg&gt;]
  &lt;br&gt;&lt;br&gt;&lt;br&gt;
  .authors140[David Beauchesne &amp; Kevin Cazelles]
  &lt;br&gt;&lt;br&gt;
  March 23, 2021
  &lt;br&gt;
  .font200[
  [&lt;svg viewBox="0 0 496 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"&gt;&lt;/path&gt;&lt;/svg&gt;](https://github.com/inSilecoInc/wksh_raster_CWS)
  ]
]

&lt;br&gt;
&lt;img src="img/logoW.png" width="140px"&gt;&lt;/img&gt;

&lt;!-- Modify accordingly --&gt;
[![deploy workshop](https://github.com/inSilecoInc/wksh_raster_CWS/actions/workflows/deploy.yml/badge.svg)](https://github.com/inSilecoInc/wksh_raster_CWS/actions/workflows/deploy.yml)

.instructors[Content under [&lt;svg viewBox="0 0 496 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93-22.13 0-33.22 14.61-33.22 43.84 0 23.57 9.21 43.84 33.22 43.84 14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98-22.6 0-73.96-10.32-73.96-77.05 0-58.69 43-77.06 72.63-77.06 30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93-22.14 0-33.22 14.61-33.22 43.84 0 23.55 9.23 43.84 33.22 43.84 14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98-22.69 0-73.96-9.87-73.96-77.05 0-58.67 42.97-77.06 72.63-77.06 30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248 129.93 0 248.44-100.87 248.44-248 0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81 0-105.42 85.43-203.27 203.72-203.27 112.53 0 202.82 89.46 202.82 203.26-.01 121.69-99.68 202.82-202.84 202.82z"&gt;&lt;/path&gt;&lt;/svg&gt; &lt;svg viewBox="0 0 496 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3 3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7 3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256 0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8 103.2 0 202.8-81.1 202.8-202.8.1-113.8-90.2-203.3-202.8-203.3z"&gt;&lt;/path&gt;&lt;/svg&gt;](https://creativecommons.org/licenses/by/4.0/) unless otherwise specified.]


---

&lt;!-- Day1 --&gt;


















---

class: inverse, center, middle

# &lt;svg viewBox="0 0 512 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"&gt;&lt;/path&gt;&lt;/svg&gt; Introduction to `stars`

![:custom_hr]()

## &lt;svg viewBox="0 0 512 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"&gt;&lt;/path&gt;&lt;/svg&gt; ~20min


---

# Package [`stars`](https://CRAN.R-project.org/package=stars): SpatioTemporal ARrayS

### Extent `sf` to Raster and Vector Datacubes

.center[[![:scale 62%](https://raw.githubusercontent.com/r-spatial/stars/master/images/cube3.png)](https://r-spatial.github.io/stars/index.html)] 
.right[.font80[see https://r-spatial.github.io/stars/index.html]]



---
# Example file 

![Accessed 16/12/2020](img/gebco.png)

- https://download.gebco.net/ 
- &lt;svg viewBox="0 0 512 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"&gt;&lt;/path&gt;&lt;/svg&gt; [data_and_script.zip](https://github.com/inSilecoInc/workshop_raster/raw/main/data_and_script.zip)




---
# Read with [`stars`](https://CRAN.R-project.org/package=stars)


```r
library(stars)
ras &lt;- read_stars("data/bathy.tif")   # argument `driver` to specify the driver
class(ras)
#&gt; [1] "stars"
ras
#&gt; stars object with 2 dimensions and 1 attribute
#&gt; attribute(s), summary of first 1e+05 cells:
#&gt;  bathy.tif [m]   
#&gt;  Min.   :-435.0  
#&gt;  1st Qu.:  23.0  
#&gt;  Median : 479.0  
#&gt;  Mean   : 299.5  
#&gt;  3rd Qu.: 540.0  
#&gt;  Max.   : 812.0  
#&gt; dimension(s):
#&gt;   from   to offset       delta refsys point values x/y
#&gt; x    1 3840    -71  0.00416667 WGS 84 FALSE   NULL [x]
#&gt; y    1 2880     55 -0.00416667 WGS 84 FALSE   NULL [y]
```


---
# What do we have? 


```r
dim(ras)
#&gt;    x    y 
#&gt; 3840 2880
st_bbox(ras)
#&gt; xmin ymin xmax ymax 
#&gt;  -71   43  -55   55
```

---
# What do we have? 


```r
ras_crs &lt;- st_crs(ras)
class(ras_crs)
#&gt; [1] "crs"
ras_crs
#&gt; Coordinate Reference System:
#&gt;   User input: WGS 84 
#&gt;   wkt:
#&gt; GEOGCRS["WGS 84",
#&gt;     DATUM["World Geodetic System 1984",
#&gt;         ELLIPSOID["WGS 84",6378137,298.257223563,
#&gt;             LENGTHUNIT["metre",1]]],
#&gt;     PRIMEM["Greenwich",0,
#&gt;         ANGLEUNIT["degree",0.0174532925199433]],
#&gt;     CS[ellipsoidal,2],
#&gt;         AXIS["geodetic latitude (Lat)",north,
#&gt;             ORDER[1],
#&gt;             ANGLEUNIT["degree",0.0174532925199433]],
#&gt;         AXIS["geodetic longitude (Lon)",east,
#&gt;             ORDER[2],
#&gt;             ANGLEUNIT["degree",0.0174532925199433]],
#&gt;     ID["EPSG",4326]]
```

---
# What do we have? 


```r
ras_crs$input
#&gt; [1] "WGS 84"
ras_crs$proj4string
#&gt; [1] "+proj=longlat +datum=WGS84 +no_defs"
ras_crs$epsg
#&gt; [1] 4326
```
--

- https://epsg.io/
- https://epsg.io/4326


---
# Conversion between [`stars`](https://CRAN.R-project.org/package=stars) and [`raster`](https://CRAN.R-project.org/package=raster)


```r
library(raster)
rar &lt;- raster("data/bathy.tif")
ras_c &lt;- st_as_stars(rar) 
class(ras_c)
#&gt; [1] "stars"
```

--


```r
rar_c &lt;- as(ras, "Raster") 
class(rar_c)
#&gt; [1] "RasterLayer"
#&gt; attr(,"package")
#&gt; [1] "raster"
```


---
# Basic cell-based computations with [`stars`](https://CRAN.R-project.org/package=stars)


```r
class(ras[[1]])
#&gt; [1] "units"
class(ras[["bathy.tif"]])
#&gt; [1] "units"
class(ras$bathy.tif)
#&gt; [1] "units"
```

---
# Use units with [`units`](https://CRAN.R-project.org/package=units)


```r
library(units)
as_units(1, "mm") + as_units(1, "cm")
#&gt; 11 [mm]
```

--


```r
units::as_units(0, "celsius") + units::as_units(0, "fahrenheit")
#&gt; -17.77778 [°C]
```

---
# Basic cell-based computations with [`stars`](https://CRAN.R-project.org/package=stars)


```r
ras_nounit &lt;- drop_units(ras)
class(ras_nounit[[1]])
#&gt; [1] "matrix" "array"
```


---
# Basic cell-based computations with [`stars`](https://CRAN.R-project.org/package=stars)


```r
# extract value
ras[[1]][1, 1]
#&gt; 457 [m]
ras[[1]][1:10, 11:20]
#&gt; Units: [m]
#&gt;       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
#&gt;  [1,]  455  475  479  476  474  473  488  529  525   521
#&gt;  [2,]  453  472  473  471  476  474  494  533  533   518
#&gt;  [3,]  454  471  471  471  477  475  493  539  536   515
#&gt;  [4,]  454  469  470  472  472  473  487  530  528   511
#&gt;  [5,]  456  469  470  475  472  476  493  519  520   508
#&gt;  [6,]  459  474  471  481  478  488  508  523  525   507
#&gt;  [7,]  459  484  473  494  487  502  519  537  537   513
#&gt;  [8,]  467  497  479  514  495  502  525  554  542   522
#&gt;  [9,]  483  506  483  526  497  495  531  554  535   525
#&gt; [10,]  508  507  485  520  490  485  530  543  527   513
```

---
# Basic cell-based computations with [`stars`](https://CRAN.R-project.org/package=stars)



```r
# mean along latitude
m_lat &lt;- apply(ras[[1]], 2, mean)
m_lat[1:10]
#&gt;  [1] 294.2492 295.1260 295.9008 297.1172 296.7591 295.6539 294.2279 295.1870
#&gt;  [9] 296.0227 296.5232
# mean along longitude
m_lon &lt;- apply(ras[[1]], 1, mean)
m_lon[1:10]
#&gt;  [1] 478.7497 479.6403 480.5201 480.8931 480.7000 480.7611 480.9503 481.4774
#&gt;  [9] 482.5569 483.8781
```


---
# Basic cell-based computations with [`stars`](https://CRAN.R-project.org/package=stars)


```r
lon &lt;- st_get_dimension_values(ras, 1)
lat &lt;- st_get_dimension_values(ras, 2)
```

---
# Basic cell-based computations with [`stars`](https://CRAN.R-project.org/package=stars)


```r
plot(lat, m_lat)
```

&lt;img src="_part2_files/figure-html/unnamed-chunk-8-1.png" style="display: block; margin: auto;" /&gt;

---
# Basic cell-based computations with [`stars`](https://CRAN.R-project.org/package=stars)


```r
range(ras[[1]])  # min/max
#&gt; Units: [m]
#&gt; [1] -4490  1502
diff(range(ras[[1]]))
#&gt; 5992 [m]
mean(ras[[1]]) 
#&gt; 59.65972 [m]
quantile(ras[[1]])
#&gt; Units: [m]
#&gt;    0%   25%   50%   75%  100% 
#&gt; -4490   -94   114   439  1502
```

---
# Basic plot with [`stars`](https://CRAN.R-project.org/package=stars)


```r
plot(ras)
```

&lt;img src="_part2_files/figure-html/plot_stars-1.png" style="display: block; margin: auto;" /&gt;

---
# Basic plot with [`stars`](https://CRAN.R-project.org/package=stars)


```r
par(mfrow = c(1, 2))
hist(ras[[1]])
plot(density(ras[[1]]))
```

&lt;img src="_part2_files/figure-html/plot_stars_ar-1.png" style="display: block; margin: auto;" /&gt;



---
# Available drivers

### - GeoTIFF &lt;svg viewBox="0 0 512 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"&gt;&lt;/path&gt;&lt;/svg&gt;

--

### - Other formats, how do we know?


```r
st_dr &lt;- sf::st_drivers(what = "raster")
head(st_dr)
#&gt;            name                                  long_name write  copy
#&gt; VRT         VRT                             Virtual Raster  TRUE  TRUE
#&gt; DERIVED DERIVED Derived datasets using VRT pixel functions FALSE FALSE
#&gt; GTiff     GTiff                                    GeoTIFF  TRUE  TRUE
#&gt; NITF       NITF       National Imagery Transmission Format  TRUE  TRUE
#&gt; RPFTOC   RPFTOC           Raster Product Format TOC format FALSE FALSE
#&gt; ECRGTOC ECRGTOC                            ECRG TOC format FALSE FALSE
#&gt;         is_raster is_vector   vsi
#&gt; VRT          TRUE     FALSE  TRUE
#&gt; DERIVED      TRUE     FALSE FALSE
#&gt; GTiff        TRUE     FALSE  TRUE
#&gt; NITF         TRUE     FALSE  TRUE
#&gt; RPFTOC       TRUE     FALSE  TRUE
#&gt; ECRGTOC      TRUE     FALSE  TRUE
```

---
# Check read/write capabilities with 



```r
st_dr[which(st_dr$name == "GTiff"), ]
#&gt;        name long_name write copy is_raster is_vector  vsi
#&gt; GTiff GTiff   GeoTIFF  TRUE TRUE      TRUE     FALSE TRUE
```

--
.right[

.font80[&lt;svg viewBox="0 0 512 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"&gt;&lt;/path&gt;&lt;/svg&gt; https://gdal.org/drivers/raster/index.html]

.font80[&lt;svg viewBox="0 0 512 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"&gt;&lt;/path&gt;&lt;/svg&gt; https://keen-swartz-3146c4.netlify.app/intro.html#reading]

]




---
# Write raster files

##  .center[.font200[&lt;svg viewBox="0 0 581 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"&gt;&lt;/path&gt;&lt;/svg&gt; &lt;svg viewBox="0 0 448 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"&gt;&lt;/path&gt;&lt;/svg&gt; &lt;svg viewBox="0 0 384 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48z"&gt;&lt;/path&gt;&lt;/svg&gt;]]

--

## - Share the output file

--

## - Use another software (e.g. QGIS)

--

&lt;br&gt;

### &lt;svg viewBox="0 0 512 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"&gt;&lt;/path&gt;&lt;/svg&gt; Create an `output` directory


```r
dir.create("output", showWarnings = FALSE)
```



---
# Write with [`stars`](https://CRAN.R-project.org/package=stars)


```r
sort(st_dr$name[st_dr$write])
#&gt;  [1] "ADRG"      "BMP"       "BT"        "BYN"       "CTable2"   "EHdr"     
#&gt;  [7] "ELAS"      "ENVI"      "ERS"       "FITS"      "GPKG"      "GS7BG"    
#&gt; [13] "GSBG"      "GTiff"     "GTX"       "HDF4Image" "HFA"       "IDA"      
#&gt; [19] "ILWIS"     "INGR"      "ISCE"      "ISIS2"     "ISIS3"     "KRO"      
#&gt; [25] "LAN"       "Leveller"  "MBTiles"   "MEM"       "MFF"       "MFF2"     
#&gt; [31] "MRF"       "netCDF"    "NGW"       "NITF"      "NTv2"      "NWT_GRD"  
#&gt; [37] "PAux"      "PCIDSK"    "PCRaster"  "PDF"       "PDS4"      "PNM"      
#&gt; [43] "RMF"       "ROI_PAC"   "RRASTER"   "RST"       "SAGA"      "SGI"      
#&gt; [49] "Terragen"  "VRT"
```

---
# Write with [`stars`](https://CRAN.R-project.org/package=stars)


```r
write_stars(ras, dsn = "output/ras.gpkg", driver = "GPKG")
```

&lt;svg viewBox="0 0 512 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"&gt;&lt;/path&gt;&lt;/svg&gt; dsn stands for **data source name**.


---
# &lt;svg viewBox="0 0 512 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M243.2 189.9V258c26.1 5.9 49.3 15.6 73.6 22.3v-68.2c-26-5.8-49.4-15.5-73.6-22.2zm223.3-123c-34.3 15.9-76.5 31.9-117 31.9C296 98.8 251.7 64 184.3 64c-25 0-47.3 4.4-68 12 2.8-7.3 4.1-15.2 3.6-23.6C118.1 24 94.8 1.2 66.3 0 34.3-1.3 8 24.3 8 56c0 19 9.5 35.8 24 45.9V488c0 13.3 10.7 24 24 24h16c13.3 0 24-10.7 24-24v-94.4c28.3-12.1 63.6-22.1 114.4-22.1 53.6 0 97.8 34.8 165.2 34.8 48.2 0 86.7-16.3 122.5-40.9 8.7-6 13.8-15.8 13.8-26.4V95.9c.1-23.3-24.2-38.8-45.4-29zM169.6 325.5c-25.8 2.7-50 8.2-73.6 16.6v-70.5c26.2-9.3 47.5-15 73.6-17.4zM464 191c-23.6 9.8-46.3 19.5-73.6 23.9V286c24.8-3.4 51.4-11.8 73.6-26v70.5c-25.1 16.1-48.5 24.7-73.6 27.1V286c-27 3.7-47.9 1.5-73.6-5.6v67.4c-23.9-7.4-47.3-16.7-73.6-21.3V258c-19.7-4.4-40.8-6.8-73.6-3.8v-70c-22.4 3.1-44.6 10.2-73.6 20.9v-70.5c33.2-12.2 50.1-19.8 73.6-22v71.6c27-3.7 48.4-1.3 73.6 5.7v-67.4c23.7 7.4 47.2 16.7 73.6 21.3v68.4c23.7 5.3 47.6 6.9 73.6 2.7V143c27-4.8 52.3-13.6 73.6-22.5z"&gt;&lt;/path&gt;&lt;/svg&gt; Recap 

&lt;br&gt;&lt;br&gt;

| Action            | *raster*                 | *stars*               |
|:------------------|:-------------------------|:----------------------|
| list drivers      | `rgdal::gdalDrivers()`   | `sf::st_drivers()`    |
| read files        | `raster()`               | `read_stars()`        |
| write files       | `writeRaster()`          | `write_stars()`       |



---
# Create a raster from scratch: Matrix


```r
M1 &lt;- matrix(runif(36), 6, 6)
M1
#&gt;           [,1]       [,2]      [,3]      [,4]      [,5]      [,6]
#&gt; [1,] 0.5919770 0.50731013 0.1871560 0.1916795 0.4085784 0.5848796
#&gt; [2,] 0.4205284 0.59464554 0.9823934 0.9342118 0.8004671 0.2816351
#&gt; [3,] 0.1490436 0.79705186 0.9549000 0.3109841 0.9572308 0.1634509
#&gt; [4,] 0.7155461 0.56120886 0.8343130 0.2074220 0.2313059 0.4828029
#&gt; [5,] 0.5305116 0.90099726 0.7581925 0.5571844 0.8137735 0.0350066
#&gt; [6,] 0.8791041 0.04242462 0.1826885 0.4065729 0.3811164 0.8604184
```

---
# Create a raster from scratch: Matrix


```r
ras_M1 &lt;- st_as_stars(M1) 
ras_M1
#&gt; stars object with 2 dimensions and 1 attribute
#&gt; attribute(s):
#&gt;       A1          
#&gt;  Min.   :0.03501  
#&gt;  1st Qu.:0.26905  
#&gt;  Median :0.54385  
#&gt;  Mean   :0.53330  
#&gt;  3rd Qu.:0.80379  
#&gt;  Max.   :0.98239  
#&gt; dimension(s):
#&gt;    from to offset delta refsys point values x/y
#&gt; X1    1  6      0     1     NA FALSE   NULL [x]
#&gt; X2    1  6      0     1     NA FALSE   NULL [y]
st_crs(ras_M1)
#&gt; Coordinate Reference System: NA
```

---
# Create a raster from scratch: Matrix


```r
plot(ras_M1)
```

&lt;img src="_part2_files/figure-html/unnamed-chunk-10-1.png" style="display: block; margin: auto;" /&gt;

---
# Create a raster from scratch: Matrix


```r
st_crs(ras_M1) &lt;- st_crs(4326)
st_crs(ras_M1)
#&gt; Coordinate Reference System:
#&gt;   User input: EPSG:4326 
#&gt;   wkt:
#&gt; GEOGCRS["WGS 84",
#&gt;     DATUM["World Geodetic System 1984",
#&gt;         ELLIPSOID["WGS 84",6378137,298.257223563,
#&gt;             LENGTHUNIT["metre",1]]],
#&gt;     PRIMEM["Greenwich",0,
#&gt;         ANGLEUNIT["degree",0.0174532925199433]],
#&gt;     CS[ellipsoidal,2],
#&gt;         AXIS["geodetic latitude (Lat)",north,
#&gt;             ORDER[1],
#&gt;             ANGLEUNIT["degree",0.0174532925199433]],
#&gt;         AXIS["geodetic longitude (Lon)",east,
#&gt;             ORDER[2],
#&gt;             ANGLEUNIT["degree",0.0174532925199433]],
#&gt;     USAGE[
#&gt;         SCOPE["unknown"],
#&gt;         AREA["World"],
#&gt;         BBOX[-90,-180,90,180]],
#&gt;     ID["EPSG",4326]]
```



---
# Create a raster from scratch: Data Frame


```r
D1 &lt;- expand.grid(lon = 1:10, lat = 1:10) 
D1$val &lt;- runif(100)
head(D1)
#&gt;   lon lat       val
#&gt; 1   1   1 0.5722579
#&gt; 2   2   1 0.6476544
#&gt; 3   3   1 0.1488751
#&gt; 4   4   1 0.6892433
#&gt; 5   5   1 0.5423980
#&gt; 6   6   1 0.4189225
```

---
# Create a raster from scratch: Data Frame


```r
ras_D1 &lt;- st_as_stars(D1, coords = c("lon", "lat"))
st_crs(ras_D1) &lt;- st_crs(4326)
ras_D1
#&gt; stars object with 2 dimensions and 1 attribute
#&gt; attribute(s):
#&gt;       val         
#&gt;  Min.   :0.01111  
#&gt;  1st Qu.:0.25138  
#&gt;  Median :0.56407  
#&gt;  Mean   :0.51752  
#&gt;  3rd Qu.:0.77175  
#&gt;  Max.   :0.99525  
#&gt; dimension(s):
#&gt;     from to offset delta refsys point values x/y
#&gt; lon    1 10    0.5     1 WGS 84    NA   NULL [x]
#&gt; lat    1 10   10.5    -1 WGS 84    NA   NULL [y]
```

* See `?st_as_stars` for more details.



















---

class: inverse, center, middle

# &lt;svg viewBox="0 0 512 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"&gt;&lt;/path&gt;&lt;/svg&gt; Raster manipulation with stars

![:custom_hr]()

## &lt;svg viewBox="0 0 512 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"&gt;&lt;/path&gt;&lt;/svg&gt; ~25min





---
# Create a modified copy


```r
ras2 &lt;- 2*ras 
ras2
#&gt; stars object with 2 dimensions and 1 attribute
#&gt; attribute(s), summary of first 1e+05 cells:
#&gt;  bathy.tif [m] 
#&gt;  Min.   :-870  
#&gt;  1st Qu.:  46  
#&gt;  Median : 958  
#&gt;  Mean   : 599  
#&gt;  3rd Qu.:1080  
#&gt;  Max.   :1624  
#&gt; dimension(s):
#&gt;   from   to offset       delta refsys point values x/y
#&gt; x    1 3840    -71  0.00416667 WGS 84 FALSE   NULL [x]
#&gt; y    1 2880     55 -0.00416667 WGS 84 FALSE   NULL [y]
```


---
# Simple cell-based filter with [`stars`](https://CRAN.R-project.org/package=stars)
  

```r
ras_f1 &lt;- ras # create a copy
ras_f1[[1]][ras[[1]] &gt; units::as_units(0, "m")] &lt;- NA # filter
plot(ras_f1)
```

&lt;img src="_part2_files/figure-html/stars_filtr-1.png" style="display: block; margin: auto;" /&gt;

---
# Simple cell-based filter with [`stars`](https://CRAN.R-project.org/package=stars)
  

```r
ras_f2 &lt;- units::drop_units(ras) # create a copy without unit
ras_f2[[1]][ras_f2[[1]] &lt; 0] &lt;- NA # filter
plot(ras_f2)
```

&lt;img src="_part2_files/figure-html/unnamed-chunk-15-1.png" style="display: block; margin: auto;" /&gt;



---
# Change map projection

- Reminder 

  - [&lt;svg viewBox="0 0 640 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M640 51.2l-.3 12.2c-28.1.8-45 15.8-55.8 40.3-25 57.8-103.3 240-155.3 358.6H415l-81.9-193.1c-32.5 63.6-68.3 130-99.2 193.1-.3.3-15 0-15-.3C172 352.3 122.8 243.4 75.8 133.4 64.4 106.7 26.4 63.4.2 63.7c0-3.1-.3-10-.3-14.2h161.9v13.9c-19.2 1.1-52.8 13.3-43.3 34.2 21.9 49.7 103.6 240.3 125.6 288.6 15-29.7 57.8-109.2 75.3-142.8-13.9-28.3-58.6-133.9-72.8-160-9.7-17.8-36.1-19.4-55.8-19.7V49.8l142.5.3v13.1c-19.4.6-38.1 7.8-29.4 26.1 18.9 40 30.6 68.1 48.1 104.7 5.6-10.8 34.7-69.4 48.1-100.8 8.9-20.6-3.9-28.6-38.6-29.4.3-3.6 0-10.3.3-13.6 44.4-.3 111.1-.3 123.1-.6v13.6c-22.5.8-45.8 12.8-58.1 31.7l-59.2 122.8c6.4 16.1 63.3 142.8 69.2 156.7L559.2 91.8c-8.6-23.1-36.4-28.1-47.2-28.3V49.6l127.8 1.1.2.5z"&gt;&lt;/path&gt;&lt;/svg&gt; List of map projections](https://en.wikipedia.org/wiki/List_of_map_projections)

--

  - [Interactive examples](https://mathigon.org/course/circles/spheres-cones-cylinders#sphere-maps)

--

- Let's use the spherical Mercator 
  - https://epsg.io/
  - https://epsg.io/3857



---
# Change map projection with [`stars`](https://CRAN.R-project.org/package=stars)

### Just as it is done with `sf`


```r
ras_t &lt;- st_transform(ras, crs = 3857)
st_crs(ras_t)
#&gt; Coordinate Reference System:
#&gt;   User input: EPSG:3857 
#&gt;   wkt:
#&gt; PROJCRS["WGS 84 / Pseudo-Mercator",
#&gt;     BASEGEOGCRS["WGS 84",
#&gt;         DATUM["World Geodetic System 1984",
#&gt;             ELLIPSOID["WGS 84",6378137,298.257223563,
#&gt;                 LENGTHUNIT["metre",1]]],
#&gt;         PRIMEM["Greenwich",0,
#&gt;             ANGLEUNIT["degree",0.0174532925199433]],
#&gt;         ID["EPSG",4326]],
#&gt;     CONVERSION["Popular Visualisation Pseudo-Mercator",
#&gt;         METHOD["Popular Visualisation Pseudo Mercator",
#&gt;             ID["EPSG",1024]],
#&gt;         PARAMETER["Latitude of natural origin",0,
#&gt;             ANGLEUNIT["degree",0.0174532925199433],
#&gt;             ID["EPSG",8801]],
#&gt;         PARAMETER["Longitude of natural origin",0,
#&gt;             ANGLEUNIT["degree",0.0174532925199433],
#&gt;             ID["EPSG",8802]],
#&gt;         PARAMETER["False easting",0,
#&gt;             LENGTHUNIT["metre",1],
#&gt;             ID["EPSG",8806]],
#&gt;         PARAMETER["False northing",0,
#&gt;             LENGTHUNIT["metre",1],
#&gt;             ID["EPSG",8807]]],
#&gt;     CS[Cartesian,2],
#&gt;         AXIS["easting (X)",east,
#&gt;             ORDER[1],
#&gt;             LENGTHUNIT["metre",1]],
#&gt;         AXIS["northing (Y)",north,
#&gt;             ORDER[2],
#&gt;             LENGTHUNIT["metre",1]],
#&gt;     USAGE[
#&gt;         SCOPE["unknown"],
#&gt;         AREA["World - 85°S to 85°N"],
#&gt;         BBOX[-85.06,-180,85.06,180]],
#&gt;     ID["EPSG",3857]]
```


---
# Crop with [`stars`](https://CRAN.R-project.org/package=raster)

&lt;img src="_part2_files/figure-html/unnamed-chunk-16-1.png" style="display: block; margin: auto;" /&gt;



---
# Crop with [`stars`](https://CRAN.R-project.org/package=raster)


```r
ext &lt;- st_bbox(c(xmin = -65, xmax = -60, ymin = 45, ymax = 50), crs = 4326)
ras_c &lt;- st_crop(ras, ext)
plot(ras_c)
```

&lt;img src="_part2_files/figure-html/crop_ras-1.png" style="display: block; margin: auto;" /&gt;


---
# Mask 

Let's use a shapefile of the Gulf of the St-Lawrence 

&lt;svg viewBox="0 0 512 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"&gt;&lt;/path&gt;&lt;/svg&gt; https://www.marineregions.org/gazetteer.php?p=details&amp;id=4290


```r
(stl &lt;- sf::st_read("data/st_laurence.geojson"))
#&gt; Reading layer `data_stl2' from data source `/__w/wksh_raster_CWS/wksh_raster_CWS/data/st_laurence.geojson' using driver `GeoJSON'
#&gt; Simple feature collection with 1 feature and 10 fields
#&gt; Geometry type: POLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -74.86481 ymin: 44.9585 xmax: -54.70345 ymax: 52.22242
#&gt; Geodetic CRS:  WGS 84
#&gt; Simple feature collection with 1 feature and 10 fields
#&gt; Geometry type: POLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -74.86481 ymin: 44.9585 xmax: -54.70345 ymax: 52.22242
#&gt; Geodetic CRS:  WGS 84
#&gt;                   name id longitude latitude     min_x   min_y     max_x
#&gt; 1 Gulf of St. Lawrence 24 -61.56657 48.38072 -74.86481 44.9585 -54.70345
#&gt;      max_y   area mrgid                       geometry
#&gt; 1 52.22242 290874  4290 POLYGON ((-64.67242 47.7168...
```

---
# Mask 

Values outside of a given geometry set to `NA`


```r
plot(sf::st_geometry(stl))
```

&lt;img src="_part2_files/figure-html/plot_stl-1.png" style="display: block; margin: auto;" /&gt;


---
# Mask with [`stars`](https://CRAN.R-project.org/package=stars)


```r
ras_m &lt;- ras[stl]
plot(ras_m)
```

&lt;img src="_part2_files/figure-html/ras_m-1.png" style="display: block; margin: auto;" /&gt;

---
# Mask with [`stars`](https://CRAN.R-project.org/package=stars)


```r
stl_i &lt;- sf::st_difference(sf::st_as_sfc(st_bbox(ras)), stl)
plot(stl_i, col = 2)
```

&lt;img src="_part2_files/figure-html/ras_m1-1.png" style="display: block; margin: auto;" /&gt;


---
# Mask with [`stars`](https://CRAN.R-project.org/package=stars)


```r
ras_mi &lt;- ras[stl_i]
plot(ras_mi)
```

&lt;img src="_part2_files/figure-html/ras_m2-1.png" style="display: block; margin: auto;" /&gt;



---
# Warping/Resampling with [`stars`](https://CRAN.R-project.org/package=stars)


```r
ras_template1 &lt;- st_as_stars(st_bbox(ras), nx = 21, ny = 21, 
  values = runif(21 * 21)) # create template
ras_w1 &lt;- st_warp(ras, ras_template1) 
plot(ras_w1)
```

&lt;img src="_part2_files/figure-html/ras_warp-1.png" style="display: block; margin: auto;" /&gt;


???

Work with rasters of different resolutions


---
# Warping/Resampling with [`stars`](https://CRAN.R-project.org/package=stars)


```r
ras_template1 &lt;- st_as_stars(st_bbox(ras), nx = 21, ny = 21, 
  values = runif(21 * 21)) # create template
ras_w1 &lt;- st_warp(ras, st_transform(ras_template1, crs = 3857)) 
plot(ras_w1)
```

&lt;img src="_part2_files/figure-html/ras_warp_crs-1.png" style="display: block; margin: auto;" /&gt;


&lt;!-- show how to do this with a second object --&gt;

---
# Warping/Resampling with [`stars`](https://CRAN.R-project.org/package=stars)


```r
ras_w2 &lt;- st_warp(ras, cellsize = 0.25, crs = st_crs(ras)) 
plot(ras_w2)
```

&lt;img src="_part2_files/figure-html/ras_warp2-1.png" style="display: block; margin: auto;" /&gt;



---
# Rasterize with [`stars`](https://CRAN.R-project.org/package=stars)


```r
ras_template1[[1]] &lt;- NA
stl_r &lt;- st_rasterize(stl, ras_template1) # use a template
plot(stl_r)
```

&lt;img src="_part2_files/figure-html/unnamed-chunk-17-1.png" style="display: block; margin: auto;" /&gt;

---
# Rasterize with [`stars`](https://CRAN.R-project.org/package=stars)


```r
stl_s &lt;- st_rasterize(stl, dy = .1, dx = .1) # use cell-size
plot(stl_s)
```

&lt;img src="_part2_files/figure-html/rasters1-1.png" style="display: block; margin: auto;" /&gt;


---
# Rasterize faster 

- Checkout [fasterize](https://github.com/ecohealthalliance/fasterize) 

- Check out [terra](https://cran.r-project.org/web/packages/terra/index.html)


---
# Mask faster with `st_rasterize()`

### Solution proposed by Dewey Dunnington
 

```r
# load files
gulf_region &lt;- sf::read_sf("data/st_laurence.geojson")
strs &lt;- stars::read_stars("data/bathy.tif")
# create raster mask
template &lt;- strs
template[[1]][] &lt;- NA
gulf_region$val_ras &lt;- 1

rasterized &lt;- stars::st_rasterize(gulf_region["val_ras"], template = template)
```

---
# Mask faster  with `st_rasterize()`

### Solution proposed by Dewey Dunnington
 

```r
plot(rasterized)
```

&lt;img src="_part2_files/figure-html/soldd2-1.png" style="display: block; margin: auto;" /&gt;






---
# Polygonize 


```r
ras_p &lt;- units::drop_units(ras)
ras_p[[1]][ras_p[[1]] &gt; 0] &lt;- NA # filter
ras_p[[1]][ras_p[[1]] &lt; 0] &lt;- 1
pol &lt;- st_as_sf(ras_p, as_points = FALSE, merge = TRUE)
```

---
# Polygonize 


```r
plot(pol)  
```

&lt;img src="_part2_files/figure-html/unnamed-chunk-18-1.png" style="display: block; margin: auto;" /&gt;

---
# Polygonize 


```r
plot(pol[which.max(st_area(pol)),])  
```

&lt;img src="_part2_files/figure-html/unnamed-chunk-19-1.png" style="display: block; margin: auto;" /&gt;


---
# Dealing with large rasters

- When a raster is large (takes fair amount of your RAM), `stars` creates a `stars_proxy` object.

&gt; Stars proxy objects take another approach: upon creation they contain no data at all, but only pointers to where the data can be read. Data is only read when it is needed, and only as much as is needed [...]. ([Stars proxy objects](https://r-spatial.github.io/stars/articles/stars2.html))


- You might want to try out [terra](https://cran.r-project.org/web/packages/terra/index.html).



---
# Stack 

### - Collection of rasters 

### - Same extent/resolution

### - Multi-band rasters (satellite images)

### - Handle several rasters at once 

--

### - `rasterStack` and `rasterBrick` in package `raster`




---
# Stack with [`stars`](https://CRAN.R-project.org/package=stars)


```r
ras
#&gt; stars object with 2 dimensions and 1 attribute
#&gt; attribute(s), summary of first 1e+05 cells:
#&gt;  bathy.tif [m]   
#&gt;  Min.   :-435.0  
#&gt;  1st Qu.:  23.0  
#&gt;  Median : 479.0  
#&gt;  Mean   : 299.5  
#&gt;  3rd Qu.: 540.0  
#&gt;  Max.   : 812.0  
#&gt; dimension(s):
#&gt;   from   to offset       delta refsys point values x/y
#&gt; x    1 3840    -71  0.00416667 WGS 84 FALSE   NULL [x]
#&gt; y    1 2880     55 -0.00416667 WGS 84 FALSE   NULL [y]
```

---
# Stack with [`stars`](https://CRAN.R-project.org/package=stars)


```r
ras_stc1 &lt;- c(ras, ras * 2)
names(ras_stc1) &lt;- c("bath_v1", "bath_v2")
ras_stc1
#&gt; stars object with 2 dimensions and 2 attributes
#&gt; attribute(s), summary of first 1e+05 cells:
#&gt;   bath_v1 [m]      bath_v2 [m]  
#&gt;  Min.   :-435.0   Min.   :-870  
#&gt;  1st Qu.:  23.0   1st Qu.:  46  
#&gt;  Median : 479.0   Median : 958  
#&gt;  Mean   : 299.5   Mean   : 599  
#&gt;  3rd Qu.: 540.0   3rd Qu.:1080  
#&gt;  Max.   : 812.0   Max.   :1624  
#&gt; dimension(s):
#&gt;   from   to offset       delta refsys point values x/y
#&gt; x    1 3840    -71  0.00416667 WGS 84 FALSE   NULL [x]
#&gt; y    1 2880     55 -0.00416667 WGS 84 FALSE   NULL [y]
```

---
# Stack with [`stars`](https://CRAN.R-project.org/package=stars)


```r
plot(ras_stc1)
```

&lt;img src="_part2_files/figure-html/ras_stc1b-1.png" style="display: block; margin: auto;" /&gt;

---
# Stack with [`stars`](https://CRAN.R-project.org/package=stars)



```r
ras_stc1[1] # or ras_stc1["bath_v1"]
#&gt; stars object with 2 dimensions and 1 attribute
#&gt; attribute(s), summary of first 1e+05 cells:
#&gt;   bath_v1 [m]    
#&gt;  Min.   :-435.0  
#&gt;  1st Qu.:  23.0  
#&gt;  Median : 479.0  
#&gt;  Mean   : 299.5  
#&gt;  3rd Qu.: 540.0  
#&gt;  Max.   : 812.0  
#&gt; dimension(s):
#&gt;   from   to offset       delta refsys point values x/y
#&gt; x    1 3840    -71  0.00416667 WGS 84 FALSE   NULL [x]
#&gt; y    1 2880     55 -0.00416667 WGS 84 FALSE   NULL [y]
```

---
# Stack with [`stars`](https://CRAN.R-project.org/package=stars)



```r
ras_stc1[2] # or ras_stc1["bath_v2"]
#&gt; stars object with 2 dimensions and 1 attribute
#&gt; attribute(s), summary of first 1e+05 cells:
#&gt;   bath_v2 [m]  
#&gt;  Min.   :-870  
#&gt;  1st Qu.:  46  
#&gt;  Median : 958  
#&gt;  Mean   : 599  
#&gt;  3rd Qu.:1080  
#&gt;  Max.   :1624  
#&gt; dimension(s):
#&gt;   from   to offset       delta refsys point values x/y
#&gt; x    1 3840    -71  0.00416667 WGS 84 FALSE   NULL [x]
#&gt; y    1 2880     55 -0.00416667 WGS 84 FALSE   NULL [y]
```


---
# Stack with [`stars`](https://CRAN.R-project.org/package=stars)


```r
library(dplyr)
ras_stc1 %&gt;% dplyr::select("bath_v1")
#&gt; stars object with 2 dimensions and 1 attribute
#&gt; attribute(s), summary of first 1e+05 cells:
#&gt;   bath_v1 [m]    
#&gt;  Min.   :-435.0  
#&gt;  1st Qu.:  23.0  
#&gt;  Median : 479.0  
#&gt;  Mean   : 299.5  
#&gt;  3rd Qu.: 540.0  
#&gt;  Max.   : 812.0  
#&gt; dimension(s):
#&gt;   from   to offset       delta refsys point values x/y
#&gt; x    1 3840    -71  0.00416667 WGS 84 FALSE   NULL [x]
#&gt; y    1 2880     55 -0.00416667 WGS 84 FALSE   NULL [y]
```

---
# Stack with [`stars`](https://CRAN.R-project.org/package=stars)


```r
ras_stc1 %&gt;% mutate(bath_v3 = bath_v2 * 2)
#&gt; stars object with 2 dimensions and 3 attributes
#&gt; attribute(s), summary of first 1e+05 cells:
#&gt;   bath_v1 [m]      bath_v2 [m]    bath_v3 [m]   
#&gt;  Min.   :-435.0   Min.   :-870   Min.   :-1740  
#&gt;  1st Qu.:  23.0   1st Qu.:  46   1st Qu.:   92  
#&gt;  Median : 479.0   Median : 958   Median : 1916  
#&gt;  Mean   : 299.5   Mean   : 599   Mean   : 1198  
#&gt;  3rd Qu.: 540.0   3rd Qu.:1080   3rd Qu.: 2160  
#&gt;  Max.   : 812.0   Max.   :1624   Max.   : 3248  
#&gt; dimension(s):
#&gt;   from   to offset       delta refsys point values x/y
#&gt; x    1 3840    -71  0.00416667 WGS 84 FALSE   NULL [x]
#&gt; y    1 2880     55 -0.00416667 WGS 84 FALSE   NULL [y]
```

---
# Stack with [`stars`](https://CRAN.R-project.org/package=stars)


```r
ras_stc2 &lt;- c(ras, ras*2, along = "z")
ras_stc2
#&gt; stars object with 3 dimensions and 1 attribute
#&gt; attribute(s), summary of first 1e+05 cells:
#&gt;  bathy.tif [m]   
#&gt;  Min.   :-435.0  
#&gt;  1st Qu.:  23.0  
#&gt;  Median : 479.0  
#&gt;  Mean   : 299.5  
#&gt;  3rd Qu.: 540.0  
#&gt;  Max.   : 812.0  
#&gt; dimension(s):
#&gt;   from   to offset       delta refsys point values x/y
#&gt; x    1 3840    -71  0.00416667 WGS 84 FALSE   NULL [x]
#&gt; y    1 2880     55 -0.00416667 WGS 84 FALSE   NULL [y]
#&gt; z    1    2     NA          NA     NA    NA   NULL
```

---
# Stack with [`stars`](https://CRAN.R-project.org/package=stars)


```r
plot(ras_stc2)
```

&lt;img src="_part2_files/figure-html/ras_stc4-1.png" style="display: block; margin: auto;" /&gt;

---
# Stack with [`stars`](https://CRAN.R-project.org/package=stars)


```r
ext &lt;- st_bbox(c(xmin = -65, xmax = -60, ymin = 45, ymax = 50), crs = 4326)
plot(st_crop(ras_stc2, ext))
```

&lt;img src="_part2_files/figure-html/ras_stc5-1.png" style="display: block; margin: auto;" /&gt;


---
# Stack with [`stars`](https://CRAN.R-project.org/package=stars)


```r
(ras_ap &lt;- st_apply(ras_stc2, c(1, 2), sum))
#&gt; stars object with 2 dimensions and 1 attribute
#&gt; attribute(s), summary of first 1e+05 cells:
#&gt;       sum         
#&gt;  Min.   :-1305.0  
#&gt;  1st Qu.:   69.0  
#&gt;  Median : 1437.0  
#&gt;  Mean   :  898.6  
#&gt;  3rd Qu.: 1620.0  
#&gt;  Max.   : 2436.0  
#&gt; dimension(s):
#&gt;   from   to offset       delta refsys point values x/y
#&gt; x    1 3840    -71  0.00416667 WGS 84 FALSE   NULL [x]
#&gt; y    1 2880     55 -0.00416667 WGS 84 FALSE   NULL [y]
```


---
# Stack with [`stars`](https://CRAN.R-project.org/package=stars)

```R
?st.apply
```

[`future.apply`](https://github.com/HenrikBengtsson/future.apply) ==&gt; `st_apply(..., future = TRUE)`


---
# Stack with [`stars`](https://CRAN.R-project.org/package=stars)


```r
plot(ras_ap)
```

&lt;img src="_part2_files/figure-html/ras_stc6b-1.png" style="display: block; margin: auto;" /&gt;


---
# &lt;svg viewBox="0 0 512 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M243.2 189.9V258c26.1 5.9 49.3 15.6 73.6 22.3v-68.2c-26-5.8-49.4-15.5-73.6-22.2zm223.3-123c-34.3 15.9-76.5 31.9-117 31.9C296 98.8 251.7 64 184.3 64c-25 0-47.3 4.4-68 12 2.8-7.3 4.1-15.2 3.6-23.6C118.1 24 94.8 1.2 66.3 0 34.3-1.3 8 24.3 8 56c0 19 9.5 35.8 24 45.9V488c0 13.3 10.7 24 24 24h16c13.3 0 24-10.7 24-24v-94.4c28.3-12.1 63.6-22.1 114.4-22.1 53.6 0 97.8 34.8 165.2 34.8 48.2 0 86.7-16.3 122.5-40.9 8.7-6 13.8-15.8 13.8-26.4V95.9c.1-23.3-24.2-38.8-45.4-29zM169.6 325.5c-25.8 2.7-50 8.2-73.6 16.6v-70.5c26.2-9.3 47.5-15 73.6-17.4zM464 191c-23.6 9.8-46.3 19.5-73.6 23.9V286c24.8-3.4 51.4-11.8 73.6-26v70.5c-25.1 16.1-48.5 24.7-73.6 27.1V286c-27 3.7-47.9 1.5-73.6-5.6v67.4c-23.9-7.4-47.3-16.7-73.6-21.3V258c-19.7-4.4-40.8-6.8-73.6-3.8v-70c-22.4 3.1-44.6 10.2-73.6 20.9v-70.5c33.2-12.2 50.1-19.8 73.6-22v71.6c27-3.7 48.4-1.3 73.6 5.7v-67.4c23.7 7.4 47.2 16.7 73.6 21.3v68.4c23.7 5.3 47.6 6.9 73.6 2.7V143c27-4.8 52.3-13.6 73.6-22.5z"&gt;&lt;/path&gt;&lt;/svg&gt; Recap 


| Action                    | `raster`               | `stars`                |
|:--------------------------|:-----------------------|:-----------------------|
| Get projection            | `projection()`         | `st_crs()`             |
| Get bounding box          | `bbox()`               | `st_bbox()`            |
| Change projection         | `projectRaster()`      | `st_transform()`       |
| Crop                      | `crop()`               | `st_crop()`            |
| Mask                      | `mask()`               | `[]&lt;-`                 |
| Resample                  | `projectRaster()`      | `st_warp()`            |
| Rasterize                 | `rasterize()`          | `st_rasterize()`       |
| Stack                     | `stack()` or `brick()` | `c(along=...)`         |
| Apply functions on stacks | `calc()`               | `st_apply()`           |


&lt;svg viewBox="0 0 512 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"&gt;&lt;/path&gt;&lt;/svg&gt; https://r-spatial.github.io/stars/articles/stars6.html











---

class: inverse, center, middle

# &lt;svg viewBox="0 0 512 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"&gt;&lt;/path&gt;&lt;/svg&gt; Exercise

![:custom_hr]()

## &lt;svg viewBox="0 0 512 512" style="height:1em;fill:currentColor;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"&gt;&lt;/path&gt;&lt;/svg&gt; ~40min


---
# Exercise

### Import a raster of elevation and the atlas data 

--

### Draw a convex hull around one colony or one species distribution

--

### Extract the values associated.

--

### Draw a histogram with those values 

--

### Extract values from raster for a given species using `st_extract()`



---

# Exercise

## Solution


```r
library(stars)
library(dplyr)
ras &lt;- read_stars("data/bathy.tif")
cdqs &lt;- st_as_sf(x = read.csv('output/CDQS_BIOMQ_2017.csv'),
                 coords = c("CentroideX", "CentroideY"),
                 crs = 4326)
cdqs_ce &lt;- cdqs %&gt;% 
  filter(Espece.Species.EN == "Common Eider") %&gt;% 
  st_union %&gt;%
  st_convex_hull
# plot(st_geometry(cdqs_ce))
# try to mask faster if you want! 
ras_tmp &lt;- st_crop(ras, st_bbox(cdqs_ce))
ras_ce &lt;- ras_tmp[cdqs_re]
# plot(ras_ce)
hist(ras_ce[[1]])
#
df_ce &lt;- st_extract(ras, cdqs %&gt;% 
  filter(Espece.Species.EN == "Common Eider"))
hist(df_ce$bathy.tif)
```


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="macros.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "dracula",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
